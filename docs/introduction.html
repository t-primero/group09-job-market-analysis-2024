<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.34">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Group 09">
<meta name="dcterms.date" content="2025-10-15">

<title>Research Introduction: AI vs.&nbsp;Non-AI Careers – Geographic &amp; Remote Work Analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-c8ad9e5dbd60b7b70b38521ab19b7da4.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-93b10530f83a0ed64c0288fd832e80ab.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Geographic &amp; Remote Work Analysis</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./introduction.html" aria-current="page"> 
<span class="menu-text">Research Introduction</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./geographic_trends.html"> 
<span class="menu-text">Geographic Trends</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./eda.html"> 
<span class="menu-text">EDA and Visualizations</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./tech_hub_analysis.html"> 
<span class="menu-text">Tech Hub Analysis</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./skill_gap_analysis.html"> 
<span class="menu-text">Skill Gap Analysis</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./RandomForest.html"> 
<span class="menu-text">Random Forest</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#research-rationale" id="toc-research-rationale" class="nav-link" data-scroll-target="#research-rationale">Research Rationale</a>
  <ul class="collapse">
  <li><a href="#ais-impact-on-employment-geography" id="toc-ais-impact-on-employment-geography" class="nav-link" data-scroll-target="#ais-impact-on-employment-geography">AI’s Impact on Employment Geography</a></li>
  <li><a href="#remote-work-and-post-pandemic-restructuring" id="toc-remote-work-and-post-pandemic-restructuring" class="nav-link" data-scroll-target="#remote-work-and-post-pandemic-restructuring">Remote Work and Post-Pandemic Restructuring</a></li>
  <li><a href="#emerging-tech-hubs-and-geographic-concentration" id="toc-emerging-tech-hubs-and-geographic-concentration" class="nav-link" data-scroll-target="#emerging-tech-hubs-and-geographic-concentration">Emerging Tech Hubs and Geographic Concentration</a></li>
  <li><a href="#urban-rural-disparities-in-remote-work-access" id="toc-urban-rural-disparities-in-remote-work-access" class="nav-link" data-scroll-target="#urban-rural-disparities-in-remote-work-access">Urban-Rural Disparities in Remote Work Access</a></li>
  </ul></li>
  <li><a href="#methodology" id="toc-methodology" class="nav-link" data-scroll-target="#methodology">Methodology</a></li>
  <li><a href="#research-questions" id="toc-research-questions" class="nav-link" data-scroll-target="#research-questions">Research Questions</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Research Introduction: AI vs.&nbsp;Non-AI Careers</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Group 09 </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">October 15, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>The American labor market is undergoing a fundamental geographic restructuring. Factors such as the COVID-19 global pandemic have shifted the way businesses operate, the rise of Artificial Intelligence (AI) continuously impacts the labor force as it improves, and emerging tech hubs have presented competition for established tech hubs. These modern complexities raise critical questions:</p>
<ul>
<li>Which cities or states have the highest job growth for AI vs.&nbsp;non-AI careers?</li>
<li>Are remote jobs increasing or decreasing across industries?</li>
<li>Do tech hubs still dominate hiring, or are other locations emerging?</li>
<li>How do urban vs.&nbsp;rural job markets differ for AI and non-AI careers?</li>
</ul>
<p>This research examines job growth patterns, remote work trends, and the shifting geography of AI and non-AI careers to understand how location shapes opportunity in the evolving American economy.</p>
</section>
<section id="research-rationale" class="level2">
<h2 class="anchored" data-anchor-id="research-rationale">Research Rationale</h2>
<section id="ais-impact-on-employment-geography" class="level3">
<h3 class="anchored" data-anchor-id="ais-impact-on-employment-geography">AI’s Impact on Employment Geography</h3>
<p><span class="citation" data-cites="bessen2018">Bessen (<a href="#ref-bessen2018" role="doc-biblioref">(2018)</a>)</span> argues that AI’s employment impact depends critically on market demand rather than automation alone. Analyzing over a century of manufacturing data, he finds that technology-driven productivity gains initially increased jobs when demand was elastic but eventually reduced employment once markets became saturated. This suggests that geographic regions where AI targets unmet needs may experience job growth, while areas where AI serves already-saturated markets face potential displacement—a distinction crucial for understanding the uneven geographic distribution of AI career opportunities.</p>
</section>
<section id="remote-work-and-post-pandemic-restructuring" class="level3">
<h3 class="anchored" data-anchor-id="remote-work-and-post-pandemic-restructuring">Remote Work and Post-Pandemic Restructuring</h3>
<p>With COVID-19 disrupting various business models, American corporations had to quickly restructure operations. Five years later, COVID-19 is no longer considered a national emergency, with various public and private sector organizations implementing return-to-office (RTO) mandates <span class="citation" data-cites="paulino2025">(<a href="#ref-paulino2025" role="doc-biblioref">Paulino et al. (2025)</a>)</span>. Although the trend is currently favorable for RTO policies, “smaller companies, which often cannot compete on salary alone, are increasingly embracing remote work flexibility to attract and retain top talent” <span class="citation" data-cites="paulino2025">(<a href="#ref-paulino2025" role="doc-biblioref">Paulino et al. (2025)</a>)</span>. Smaller companies can use remote work policies to their advantage, whether to lower their overhead costs or retain top talent without offering as much salary compared to in-office based roles.</p>
</section>
<section id="emerging-tech-hubs-and-geographic-concentration" class="level3">
<h3 class="anchored" data-anchor-id="emerging-tech-hubs-and-geographic-concentration">Emerging Tech Hubs and Geographic Concentration</h3>
<p>Tech hubs seem to be emerging in droves across various parts of America. According to <span class="citation" data-cites="chen2024">Chen, Levanon, and Sigelman (<a href="#ref-chen2024" role="doc-biblioref">(2024)</a>)</span>, although there are many smaller hubs forming, the Silicon Valley on the West Coast of the United States is still dominant. They explore the idea that there is a relationship between emerging tech hubs and established tech hubs: “the greatest determinant of migration is geographic proximity” <span class="citation" data-cites="chen2024">(<a href="#ref-chen2024" role="doc-biblioref">Chen, Levanon, and Sigelman (2024)</a>)</span>. Another reason for the expansion of tech hubs in the United States is “likely motivated by quality of life and cost of living” <span class="citation" data-cites="chen2024">(<a href="#ref-chen2024" role="doc-biblioref">Chen, Levanon, and Sigelman (2024)</a>)</span>. Although other tech hubs are spreading towards other regions in the United States, Silicon Valley residents shouldn’t see this as a threat, since growing tech talent causes a synergy that, as a result, both grows and redistributes tech employment.</p>
</section>
<section id="urban-rural-disparities-in-remote-work-access" class="level3">
<h3 class="anchored" data-anchor-id="urban-rural-disparities-in-remote-work-access">Urban-Rural Disparities in Remote Work Access</h3>
<p>Geographic location significantly shapes access to remote work opportunities, with important implications for employment equity. <span class="citation" data-cites="paul2022">Paul (<a href="#ref-paul2022" role="doc-biblioref">(2022)</a>)</span> analyzes pre-pandemic travel survey data and finds that rural workers prefer but rarely access work-from-home arrangements compared to urban counterparts, primarily due to inadequate broadband infrastructure and the geographic concentration of remote-compatible jobs in metropolitan areas. The study reveals that urban workers were nearly twice as likely to have remote work options, while rural workers—particularly Hispanic rural workers—faced compounded disadvantages in accessing virtual employment. These patterns suggest that AI careers requiring advanced digital infrastructure and remote work capabilities may concentrate in urban areas unless targeted policies address rural technology access gaps.</p>
</section>
</section>
<section id="methodology" class="level2">
<h2 class="anchored" data-anchor-id="methodology">Methodology</h2>
<p>We undertook an investigation of job posting data from January to September 2024. Our tool, Lightcast, enabled us to standardize the many titles, locations, and employer information that populated the job postings. Through that process, we also conducted a feature analysis to understand the kinds of construction that are going on for jobs requiring artificial intelligence “in both a technical and a generative sense.” Overall, we read just over 22,000 job postings requiring AI-related skills.</p>
<p>Then on the basic level, we conducted some summary and inferential statistics to understand the kinds of pay differences that might exist among postings for AI and non-AI jobs. On another level, we ran the postings through a random-forest regressor—a kind of model that uses certain given variables to try to explain or understand what is going on with the posting salaries. The model itself has 10 different versions, and each one assigns weights to the different given variables (such as the industry in which the job is located) to come up with a predicted salary. Results should shed light on the nature of pay for AI skills in the job market and how geographic and industrial factors influence compensation patterns.</p>
</section>
<section id="research-questions" class="level2">
<h2 class="anchored" data-anchor-id="research-questions">Research Questions</h2>
<p>This analysis addresses the following key questions:</p>
<ol type="1">
<li><p><strong>Geographic Distribution</strong>: Where are AI jobs concentrated, and how does this compare to non-AI career opportunities?</p></li>
<li><p><strong>Remote Work Trends</strong>: How have remote, hybrid, and on-site work arrangements evolved post-pandemic for AI versus non-AI positions?</p></li>
<li><p><strong>Urban-Rural Divide</strong>: What disparities exist between urban and rural areas in terms of AI job growth and compensation?</p></li>
<li><p><strong>Compensation Patterns</strong>: How do salaries for AI-related positions compare across different geographic regions and work arrangements?</p></li>
</ol>
</section>
<section id="references" class="level2">
<h2 class="anchored" data-anchor-id="references">References</h2>
<div id="refs" class="references csl-bib-body hanging-indent" role="list">
<div id="ref-bessen2018" class="csl-entry" role="listitem">
<span class="smallcaps">Bessen, J.</span> (2018): <a href="https://www.nber.org/system/files/working_papers/w24235/w24235.pdf">AI and Jobs: The Role of Demand</a>, Working Paper, National Bureau of Economic Research.
</div>
<div id="ref-chen2024" class="csl-entry" role="listitem">
<span class="smallcaps">Chen, Z., G. Levanon, and M. Sigelman</span>. (2024): <a href="https://static1.squarespace.com/static/6197797102be715f55c0e0a1/t/65fb30d034d0475ebcc4a35f/1710960849548/Americas+Tech+Hubs+Multiplying+vFinal.pdf">America’s Tech Hubs Are Multiplying: How Tech Powerhouses’ Diaspora Are Fueling the Rise of New Cities on the Talent Frontier</a>,The Burning Glass Institute.
</div>
<div id="ref-paul2022" class="csl-entry" role="listitem">
<span class="smallcaps">Paul, J. A.</span> (2022): <span>“<a href="https://www.sciencedirect.com/science/article/pii/S0743016722002534">Work from home behaviors among u.s. Urban and rural residents</a>,”</span> <em>Transportation Research Part A: Policy and Practice</em>, 165, 254–69.
</div>
<div id="ref-paulino2025" class="csl-entry" role="listitem">
<span class="smallcaps">Paulino, M., S. J. London, L. M. Giurge, R. W. Buell, and A. S. Gabriel</span>. (2025): <span>“<a href="https://www.cambridge.org/core/services/aop-cambridge-core/content/view/D1F042CA6ADB46C9253A7B3E742D56DD/S1754942625100199a.pdf">Return-to-office mandates and workplace inequality: Implications for industrial-organizational psychology</a>,”</span> <em>Industrial and Organizational Psychology</em>,.
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>